# VDTuner 坑爹问题汇总

## 1. 磁盘空间爆炸与 Milvus 启动失败

### 问题现象
在进行调优测试时，`milvus-standalone` 容器突然无法启动，报错日志显示：
`Storage backend has reached its minimum free drive threshold. Please delete a few objects to proceed.`
检查服务器发现磁盘占用率达到 100%，其中 Milvus 的 `volumes` 文件夹占据了数个 TB 的空间。

### 核心原因
1. **数据累积**：Milvus 在运行过程中会产生大量的日志、元数据和索引数据，全部存储在 `engine/servers/milvus-single-node/volumes` 目录下。
2. **清理机制失效**：虽然测试脚本中使用了 `docker compose down -v`，但由于 Docker 配置文件使用了 **绑定挂载 (Bind Mounts)**（即把宿主机物理文件夹直接映射进容器），Docker 为了保护宿主机数据，**永远不会**自动删除这些物理文件夹里的内容。
3. **路径硬编码**：由于之前配置文件中写死了绝对路径（如 `/home/dyx/VDTuner/...`），在移动项目文件夹后，旧路径失效，导致 Docker 挂载出错甚至创建了错误的 root 权限文件夹。

### 解决方案

#### 1. 优化配置文件
将 `docker-compose.yml` 中的绝对路径改为**相对路径**，增加项目的可移植性：
```yaml
# 修改前
- /home/dyx/VDTuner/vector-db-benchmark-master/engine/servers/milvus-single-node/milvus.yaml:/milvus/configs/milvus.yaml
# 修改后
- ./milvus.yaml:/milvus/configs/milvus.yaml
```

#### 2. 彻底清理数据（无 sudo 权限方案）
由于 `volumes` 目录下的文件通常是 root 权限，普通用户无法直接 `rm -rf`。可以利用 Docker 的 root 权限来清理：
```bash
# 进入 Milvus 配置目录
cd /home/dyx/VDTuner/vector-db-benchmark-master/engine/servers/milvus-single-node

# 停止容器
docker compose down

# 使用本地已有镜像（如 redis:6-alpine）作为临时工具清理数据
docker run --rm -v $(pwd)/volumes:/data docker.1ms.run/redis:6-alpine sh -c "rm -rf /data/*"
```

#### 3. 预防建议
*   **定期清理**：每次更换大规模数据集（Dataset）进行调优前，建议执行上述清理指令。
*   **监控空间**：使用 `df -h .` 定期检查 `/home` 分区的剩余空间。
